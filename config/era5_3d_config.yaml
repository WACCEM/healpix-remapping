# ERA5 3D Variables Configuration
# Base directory for ERA5 3D pressure level data
input_base_dir: "/global/cfs/projectdirs/m3522/cmip6/ERA5/e5.oper.an.pl"

# Output directory for remapped HEALPix data
output_base_dir: "/pscratch/sd/w/wcmca1/hackathon/healpix/era5"
output_basename: "era5_3d"

# Processing parameters
default_zoom: 8           # Default HEALPix zoom level
time_chunk_size: 8
original_time_suffix: '1H' # Original time resolution suffix for output filename
time_subset: '3h'        # Optional: Subset time to this interval (overrides original_time_suffix in filename)

# Weights file path (template with {zoom} placeholder)
weights_file: "/pscratch/sd/w/wcmca1/hackathon/healpix/era5/weights/era5_z{zoom}_weights.nc"

# ERA5 3D variables
# Each variable stored in daily files within monthly directories (YYYYMM/)
# Format: var_code, var_name (in file), grid_type (sc=scalar, uv=vector)
era5_variables:
  # T: Air Temperature
  - var_code: "128_130_t"
    var_name: "T"
    grid_type: "sc"
  
  # Q: Specific Humidity
  - var_code: "128_133_q"
    var_name: "Q"
    grid_type: "sc"
  
  # R: Relative Humidity
  - var_code: "128_157_r"
    var_name: "R"
    grid_type: "sc"

  # Z: Geopotential
  - var_code: "128_129_z"
    var_name: "Z"
    grid_type: "sc"
  
  # U: Zonal Wind (vector grid - may have slight offset from scalar)
  - var_code: "128_131_u"
    var_name: "U"
    grid_type: "uv"
  
  # V: Meridional Wind (vector grid)
  - var_code: "128_132_v"
    var_name: "V"
    grid_type: "uv"
  
  # W: Vertical Velocity (omega)
  - var_code: "128_135_w"
    var_name: "W"
    grid_type: "sc"

# Variable remapping (input_name: output_name)
# Note: ERA5 uses uppercase variable names in files
remap_variables:
  T: "ta"      # Temperature
  Q: "hus"     # Specific humidity
  R: "hur"     # Relative humidity
  Z: "zg"      # Geopotential
  U: "ua"      # Zonal wind
  V: "va"      # Meridional wind
  W: "omega"   # Vertical velocity

# Pass-through variables (not remapped)
passthrough_variables:
  - level      # Pressure levels

# ERA5 file organization
# Files are in monthly directories (YYYYMM) with daily files
# Each file contains 24 hours: YYYYMMDD00_YYYYMMDD23
use_monthly_dirs: true  # Use YYYYMM directories (not YYYY)

# File template pattern for 3D variables
file_template: "e5.oper.an.pl.{var_code}.ll025{grid_type}.{date_start}_{date_end}.nc"

# Grid configuration - ERA5 is regular lat/lon grid
grid_type: 'latlon_1d'  # Regular 1D lat/lon coordinates
x_dimname: "longitude"
y_dimname: "latitude"
x_coordname: "longitude"
y_coordname: "latitude"
spatial_dimensions:
  latitude: -1   # Keep full latitude dimension
  longitude: -1  # Keep full longitude dimension

# Time dimension
concat_dim: "time"

# Dask configuration
dask:
  n_workers: 16
  threads_per_worker: 1
  # memory_limit: auto  # Auto-calculated based on system memory

# Notes:
# - ERA5 data has 37 pressure levels (1000 to 1 hPa)
# - Grid resolution: 0.25° × 0.25° (721 lat × 1440 lon)
# - Time resolution: hourly (24 steps per file)
# - Each variable in separate files organized by month
